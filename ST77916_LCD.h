#ifndef _ST77916_LCD_H
#define _ST77916_LCD_H

#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "driver/spi_master.h"
#include "Arduino.h"

#define LCD_SPI_HOST SPI2_HOST
#define LCD_H_RES 360
#define LCD_V_RES 360
#define SEND_BUF_SIZE (0x4000) //(LCD_H_RES * LCD_V_RES + 8) / 10

static spi_device_handle_t spi_dev;

class ST77916_LCD
{
public:
    ST77916_LCD(int8_t sck_pin, int8_t qspi_0_pin, int8_t qspi_1_pin, int8_t qspi_2_pin,
                int8_t qspi_3_pin, int8_t cs_pin, int8_t lcd_rst_pin = -1);

    void begin();
    void lcd_address_set(uint16_t x1, uint16_t y1, uint16_t x2, uint16_t y2);
    void lcd_PushColors(uint16_t x, uint16_t y, uint16_t width, uint16_t high, uint16_t *data);
    void lcd_fill(uint16_t xsta, uint16_t ysta, uint16_t xend, uint16_t yend, uint16_t color);

private:
    int8_t _lcd_rst, _sck, _qspi_0, _qspi_1, _qspi_2, _qspi_3, _cs;

    void lcd_write_cmd(uint32_t cmd, uint8_t *data, uint32_t len);
};

typedef struct
{
    uint8_t cmd;
    uint8_t data[14];
    uint8_t len;
    uint8_t delay_ms;
} lcd_cmd_data_t;

DRAM_ATTR static const lcd_cmd_data_t lcd_cmd_data[] = {
    {0xF0, {0x08}, 1, 0},
    {0xF2, {0x08}, 1, 0},
    {0x9B, {0x51}, 1, 0},
    {0x86, {0x53}, 1, 0},
    {0xF2, {0x80}, 1, 0},
    {0xF0, {0x00}, 1, 0},
    {0xF0, {0x01}, 1, 0},
    {0xF1, {0x01}, 1, 0},
    {0xB0, {0x54}, 1, 0},
    {0xB1, {0x3F}, 1, 0},
    {0xB2, {0x2A}, 1, 0},
    {0xB4, {0x46}, 1, 0},
    {0xB5, {0x34}, 1, 0},
    {0xB6, {0xD5}, 1, 0},
    {0xB7, {0x30}, 1, 0},
    {0xBA, {0x00}, 1, 0},
    {0xBB, {0x08}, 1, 0},
    {0xBC, {0x08}, 1, 0},
    {0xBD, {0x00}, 1, 0},
    {0xC0, {0x80}, 1, 0},
    {0xC1, {0x10}, 1, 0},
    {0xC2, {0x37}, 1, 0},
    {0xC3, {0x80}, 1, 0},
    {0xC4, {0x10}, 1, 0},
    {0xC5, {0x37}, 1, 0},
    {0xC6, {0xA9}, 1, 0},
    {0xC7, {0x41}, 1, 0},
    {0xC8, {0x51}, 1, 0},
    {0xC9, {0xA9}, 1, 0},
    {0xCA, {0x41}, 1, 0},
    {0xCB, {0x51}, 1, 0},
    {0xD0, {0x91}, 1, 0},
    {0xD1, {0x68}, 1, 0},
    {0xD2, {0x69}, 1, 0},
    {0xF5, {0x00, 0xA5}, 2, 0},
    {0xDD, {0x3F}, 1, 0},
    {0xDE, {0x3F}, 1, 0},
    {0xF1, {0x10}, 1, 0},
    {0xF0, {0x00}, 1, 0},
    {0xF0, {0x02}, 1, 0},
    {0xE0, {0x70, 0x09, 0x12, 0x0C, 0x0B, 0x27, 0x38, 0x54, 0x4E, 0x19, 0x15, 0x15, 0x2C, 0x2F}, 14, 0},
    {0xE1, {0x70, 0x08, 0x11, 0x0C, 0x0B, 0x27, 0x38, 0x43, 0x4C, 0x18, 0x14, 0x14, 0x2B, 0x2D}, 14, 0},
    {0xF0, {0x10}, 1, 0},
    {0xF3, {0x10}, 1, 0},
    {0xE0, {0x08}, 1, 0},
    {0xE1, {0x00}, 1, 0},
    {0xE2, {0x00}, 1, 0},
    {0xE3, {0x00}, 1, 0},
    {0xE4, {0xE0}, 1, 0},
    {0xE5, {0x06}, 1, 0},
    {0xE6, {0x21}, 1, 0},
    {0xE7, {0x00}, 1, 0},
    {0xE8, {0x05}, 1, 0},
    {0xE9, {0x82}, 1, 0},
    {0xEA, {0xDF}, 1, 0},
    {0xEB, {0x89}, 1, 0},
    {0xEC, {0x20}, 1, 0},
    {0xED, {0x14}, 1, 0},
    {0xEE, {0xFF}, 1, 0},
    {0xEF, {0x00}, 1, 0},
    {0xF8, {0xFF}, 1, 0},
    {0xF9, {0x00}, 1, 0},
    {0xFA, {0x00}, 1, 0},
    {0xFB, {0x30}, 1, 0},
    {0xFC, {0x00}, 1, 0},
    {0xFD, {0x00}, 1, 0},
    {0xFE, {0x00}, 1, 0},
    {0xFF, {0x00}, 1, 0},
    {0x60, {0x42}, 1, 0},
    {0x61, {0xE0}, 1, 0},
    {0x62, {0x40}, 1, 0},
    {0x63, {0x40}, 1, 0},
    {0x64, {0x02}, 1, 0},
    {0x65, {0x00}, 1, 0},
    {0x66, {0x40}, 1, 0},
    {0x67, {0x03}, 1, 0},
    {0x68, {0x00}, 1, 0},
    {0x69, {0x00}, 1, 0},
    {0x6A, {0x00}, 1, 0},
    {0x6B, {0x00}, 1, 0},
    {0x70, {0x42}, 1, 0},
    {0x71, {0xE0}, 1, 0},
    {0x72, {0x40}, 1, 0},
    {0x73, {0x40}, 1, 0},
    {0x74, {0x02}, 1, 0},
    {0x75, {0x00}, 1, 0},
    {0x76, {0x40}, 1, 0},
    {0x77, {0x03}, 1, 0},
    {0x78, {0x00}, 1, 0},
    {0x79, {0x00}, 1, 0},
    {0x7A, {0x00}, 1, 0},
    {0x7B, {0x00}, 1, 0},
    {0x80, {0x48}, 1, 0},
    {0x81, {0x00}, 1, 0},
    {0x82, {0x05}, 1, 0},
    {0x83, {0x02}, 1, 0},
    {0x84, {0xDD}, 1, 0},
    {0x85, {0x00}, 1, 0},
    {0x86, {0x00}, 1, 0},
    {0x87, {0x00}, 1, 0},
    {0x88, {0x48}, 1, 0},
    {0x89, {0x00}, 1, 0},
    {0x8A, {0x07}, 1, 0},
    {0x8B, {0x02}, 1, 0},
    {0x8C, {0xDF}, 1, 0},
    {0x8D, {0x00}, 1, 0},
    {0x8E, {0x00}, 1, 0},
    {0x8F, {0x00}, 1, 0},
    {0x90, {0x48}, 1, 0},
    {0x91, {0x00}, 1, 0},
    {0x92, {0x09}, 1, 0},
    {0x93, {0x02}, 1, 0},
    {0x94, {0xE1}, 1, 0},
    {0x95, {0x00}, 1, 0},
    {0x96, {0x00}, 1, 0},
    {0x97, {0x00}, 1, 0},
    {0x98, {0x48}, 1, 0},
    {0x99, {0x00}, 1, 0},
    {0x9A, {0x0B}, 1, 0},
    {0x9B, {0x02}, 1, 0},
    {0x9C, {0xE3}, 1, 0},
    {0x9D, {0x00}, 1, 0},
    {0x9E, {0x00}, 1, 0},
    {0x9F, {0x00}, 1, 0},
    {0xA0, {0x48}, 1, 0},
    {0xA1, {0x00}, 1, 0},
    {0xA2, {0x04}, 1, 0},
    {0xA3, {0x02}, 1, 0},
    {0xA4, {0xDC}, 1, 0},
    {0xA5, {0x00}, 1, 0},
    {0xA6, {0x00}, 1, 0},
    {0xA7, {0x00}, 1, 0},
    {0xA8, {0x48}, 1, 0},
    {0xA9, {0x00}, 1, 0},
    {0xAA, {0x06}, 1, 0},
    {0xAB, {0x02}, 1, 0},
    {0xAC, {0xDE}, 1, 0},
    {0xAD, {0x00}, 1, 0},
    {0xAE, {0x00}, 1, 0},
    {0xAF, {0x00}, 1, 0},
    {0xB0, {0x48}, 1, 0},
    {0xB1, {0x00}, 1, 0},
    {0xB2, {0x08}, 1, 0},
    {0xB3, {0x02}, 1, 0},
    {0xB4, {0xE0}, 1, 0},
    {0xB5, {0x00}, 1, 0},
    {0xB6, {0x00}, 1, 0},
    {0xB7, {0x00}, 1, 0},
    {0xB8, {0x48}, 1, 0},
    {0xB9, {0x00}, 1, 0},
    {0xBA, {0x0A}, 1, 0},
    {0xBB, {0x02}, 1, 0},
    {0xBC, {0xE2}, 1, 0},
    {0xBD, {0x00}, 1, 0},
    {0xBE, {0x00}, 1, 0},
    {0xBF, {0x00}, 1, 0},
    {0xC0, {0x12}, 1, 0},
    {0xC1, {0xAA}, 1, 0},
    {0xC2, {0x65}, 1, 0},
    {0xC3, {0x74}, 1, 0},
    {0xC4, {0x47}, 1, 0},
    {0xC5, {0x56}, 1, 0},
    {0xC6, {0x00}, 1, 0},
    {0xC7, {0x88}, 1, 0},
    {0xC8, {0x99}, 1, 0},
    {0xC9, {0x33}, 1, 0},
    {0xD0, {0x21}, 1, 0},
    {0xD1, {0xAA}, 1, 0},
    {0xD2, {0x65}, 1, 0},
    {0xD3, {0x74}, 1, 0},
    {0xD4, {0x47}, 1, 0},
    {0xD5, {0x56}, 1, 0},
    {0xD6, {0x00}, 1, 0},
    {0xD7, {0x88}, 1, 0},
    {0xD8, {0x99}, 1, 0},
    {0xD9, {0x33}, 1, 0},
    {0xF3, {0x01}, 1, 0},
    {0xF0, {0x00}, 1, 0},
    {0xF0, {0x01}, 1, 0},
    {0xF1, {0x01}, 1, 0},
    {0xA0, {0x0B}, 1, 0},
    {0xA3, {0x2A}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x2B}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x2C}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x2D}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x2E}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x2F}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x30}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x31}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x32}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA3, {0x33}, 1, 0},
    {0xA5, {0xC3}, 1, 1},
    {0xA0, {0x09}, 1, 0},
    {0xF1, {0x10}, 1, 0},
    {0xF0, {0x00}, 1, 0},
    {0x2A, {0x00, 0x00, 0x01, 0x67}, 4, 0},
    {0x2B, {0x01, 0x68, 0x01, 0x68}, 4, 0},
    {0x4D, {0x00}, 1, 0},
    {0x4E, {0x00}, 1, 0},
    {0x4F, {0x00}, 1, 0},
    {0x4C, {0x01}, 1, 10},
    {0x4C, {0x00}, 1, 0},
    {0x2A, {0x00, 0x00, 0x01, 0x67}, 4, 0},
    {0x2B, {0x00, 0x00, 0x01, 0x67}, 4, 0},
    {0x21, {0x00}, 1, 0},
    {0x3A, {0X55}, 1, 0}, // color=16
    {0x11, {0x00}, 1, 120},
    {0x29, {0x00}, 1, 0},
};

#endif
